---
title: "Lab 5"
author: "Nicholas Abad"
date: "11/2/2017"
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
---
## Question 1
Q: Load data into R. Combine the comments from the columns into a single column containing communts. Call the column "All.comments".

A:
```{r, warning=FALSE, cache = FALSE, echo = FALSE, include=FALSE}
library(dplyr)
library(stringr)
library(tidyverse)
library(ggplot2)
library(lubridate)
```
```{r}
data <- read.csv("Australia_severe_storms_1975-2015.csv")
data$All.comments <- str_c(data$Comments, " ", 
                           data$X, " ", 
                           data$X.1, " ", 
                           data$X.2, " ", 
                           data$X.3, " ", 
                           data$X.4)
data <- select(data, c(Event.ID, Database, Date.Time, State, All.comments))
print(sapply(data, class))
```

## Question 2
Q: Create an indicator variable which states whether or not a storm event has resulted in a flash flood. 

A: I added another column called "flash_flood" in order to create a TRUE/FALSE vector where TRUE corresponds to the observation resulting in a flash flood and FALSE otherwise. 
```{r}
expr <- "[fF]lash"
data$flash_flood <- str_detect(data$All.comments, expr)
```

Q: Print a plot of the number of flash flood per year from 1975 to 2015.

A: I first obtained the year in which each observation from the original data set occurred and then created a subset of the original data frame in which that subset only contains those observations that resulted in a flash flood. From that subsetted data frame, I then used the table() command in order to count the amount of floods per year then plotted this. 
```{r}
data$year <- year(dmy_hm(data$Date.Time))

subset <- subset(data, data$flash_flood == TRUE)

year_count <- data.frame(
  table(subset$year)
)

plot(
  x = as.vector(year_count$Var1),
  xlab = "Year",
  y = as.vector(year_count$Freq),
  ylab = "Number of Flash Floods",
  main = "Number of Flash floods from 1975-2015",
  type = "l"
)
```

## Question 3
Q: Extract all the wind speeds both those in knots and km/h.

A: I created a new column in the data set called "windspeed" and itialized it as NA. From this I then created one regular expression that would capture all of the observations with knots (or knot, kts, or kt) and then another regular expression that would capture all of the observations containing kilometers per hour (or km/h, km/hr, kilometres per hour, etc.). With these expressions, I then created two subsets called "data_with_knots" and "data_with_km".
```{r}
data$windspeed <- NA

knot_expression <- "[kK]not|[kK]t\b|[kK]ts\b"
data_with_knots <- subset(data, str_detect(data$All.comments, knot_expression) == TRUE)

km_expression <- "[kK]m\b|[kK]m/|[kK]m.|[kK]ilometres per|[kK]ilometers per"
data_with_km <- subset(data, str_detect(data$All.comments, km_expression) == TRUE)
```

Q: Convert km/h wind speeds to knots rounding the wind speed to the nearest knot. 

A: For the data_with_kim data frame, I extracted the speeds via regular expressions, multiplied those numerical values by 0.5399568 since 1 knot = 0.5399568, and added those values to a new column called "knots". I also removed all observations where the windspeed is still NA.
```{r}
km_speed_expression <- "\\d+[kK]m|
\\d+ [kK]m|
\\d+[kK]m.|
\\d+ [kK]m.|
\\d+[kK]ilometres per|
\\d+[kK]ilometres per|
\\d+[kK]ilometers per|
\\d+ [kK]ilometers per"
data_with_km$windspeed <- str_extract(data_with_km$All.comments, 
                                      km_speed_expression)

km_number_extraction <- "\\d+"
data_with_km$knots <- round(0.5399568 *
                              as.numeric(as.character(str_extract(data_with_km$windspeed,
                                                                  km_number_extraction))))

data_with_km <- subset(data_with_km, 
                       !is.na(data_with_km$windspeed))

```

Likewise with the data_with_knots data frame, I first extracted the observations that contained knots, then extracted just the numbers of those observations and added those numbers to a new column called "knots".
```{r}
knot_speed_expression <- "\\d+[kK]not|\\d+ [kK]not|\\d+[kK]t|\\d+ [kK]t"

data_with_knots$windspeed <- str_extract(data_with_knots$All.comments, 
                                         knot_speed_expression)

knots_number_extraction <- "\\d+"
data_with_knots$knots <- str_extract(data_with_knots$windspeed, 
                                     knots_number_extraction)
```

Q: Print a boxplot of the wind speeds recorded per state.

A: I concatanated the data_with_kim data frame with the data_with_knots data frame and named that new data frame "data_with_all_speeds". From that data frame, I printed a boxplot of the wind speeds recorded per state. 
```{r}
data_with_all_speeds <- rbind(data_with_km, data_with_knots)

data_with_all_speeds$knots <- as.numeric(as.character((data_with_all_speeds$knots)))

boxplot(
  data_with_all_speeds$knots ~ data_with_all_speeds$State,
  data = data_with_all_speeds
)
```

Because there was one outlier with a reported speed of 540 knots (or 1000 km/hr), I created a new subset that did not contain that observation to see the rest of the boxplot more clearly. 
```{r}
data_with_all_speeds_no.outlier <- subset(data_with_all_speeds, 
                                          data_with_all_speeds$knots != 540)

boxplot(
  data_with_all_speeds_no.outlier$knots ~ data_with_all_speeds_no.outlier$State,
  data = data_with_all_speeds_no.outlier
)
```
